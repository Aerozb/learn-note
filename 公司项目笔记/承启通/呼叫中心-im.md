访客/坐席端，im服务，呼叫中心服务之间交互的流程图时序图可以看本md所在目录的IM.drawio

访客端和坐席端会分别和im服务，呼叫中心服务建立websocket链接

和im服务连接是为了聊天用，而和呼叫中心链接是为了查询，保存信息等操作，原本可以使用http请求，但是不懂为啥要用websocket

登录成功后，im服务会发送mq，呼叫中心接收到消息，进行判断

1. 当用户是访客就发送导航栏信息，请求im服务接口，通过im发送消息给访客

2. 当用户是坐席就更新坐席状态

>  非聊天记录的消息都通过websocket和前端传输，需要保留聊天记录的，就先发到im，im再通过websocket发到前端



# 超时自动结束会话

1. 访客点击 导航栏-转人工 的时候发送一个延时消息到mq，延时分钟从配置的超时分钟获取

2. 每次聊天，都会往redis设置这个会话的超时日期时间

3. 等收到延时消息，根据当前时间和redis上这个会话的超时日期时间对比，大于等于就结束会话，否则重新再发一条延时消息，等待下次超时判断







