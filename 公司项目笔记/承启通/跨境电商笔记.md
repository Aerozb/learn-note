域名只会访问主的，两个redis，所以永远只会访问主的redis，除非切换到备机房

# 获取号码功能

## V1版本

从数据库根据号码排序获取，获取完了，就重头开始获取，获取的号码都放到redis，每次获取时都去除redis的号码

由于号码可能在不同国家相同，获取接口使用国家维度的锁，防止被不同用户重复获取

## v2版本

新增号码时，将号码存放到redis的list，有人获取就取出来，redis是单线程不用担心并发，如果获取的数量不满足用户要购买的数量，就放回redis

如果redis宕机了，就请求数据库查询待售的并把待支付订单的号码去掉，放回redis

如果获取完了，就没办法像V1版本从头获取

取消订单完也会把号码放回redis

### 为什么不用set存储，然后pop随机获取呢

因为是双机房，pop没办法保证两个机房的redis随机获取的都是一样的，所以使用list，按顺序存放和获取

# rocketmq分布式事务

